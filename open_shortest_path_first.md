**OSPF（Open Shortest Path First）协议**

---

## 🧭 什么是 OSPF？

**OSPF（开放最短路径优先）** 是一种链路状态的内部网关协议（IGP），被广泛用于中大型企业网络。

* **协议类型**：链路状态协议
* **度量标准**：Cost（通常与带宽有关）
* **算法**：Dijkstra 最短路径优先（SPF）算法
* **标准组织**：IETF，属于开放标准（RFC 2328）

---

## 📌 OSPF 的核心特点

| 特性       | 描述                             |
| -------- | ------------------------------ |
| 分层设计     | 支持“区域（Area）”结构，减少路由计算负担        |
| 快速收敛     | 网络拓扑发生变化时能迅速更新路由表              |
| 无类协议     | 支持 VLSM 和 CIDR，可灵活划分子网         |
| 使用链路状态信息 | 每台路由器维护网络拓扑图，而非简单跳数表           |
| 只发送变化部分  | 与 RIP 每次发送整个路由表不同，OSPF 只传播变更部分 |

---

## 🗺 OSPF 工作原理（简化流程）

### 1️⃣ 建立邻居关系（Hello 协议）

* 路由器通过发送 **Hello 报文** 发现相邻路由器（邻居）。
* Hello 包会包含：

  * Router ID
  * 区域号（Area ID）
  * Hello 和 Dead 时间
  * 网络掩码等信息

✅ 两台路由器参数一致，才能成为邻居。

---

### 2️⃣ 交换链路状态信息（LSA）

* 一旦建立邻居关系，路由器就交换链路状态广告（**LSA**）。
* LSA 包含自身连接的链路信息。

---

### 3️⃣ 构建拓扑数据库（LSDB）

* 每台路由器会汇总所有 LSA，构建完整的拓扑图（**链路状态数据库**）。
* 所有同一区域内的路由器 LSDB 是一致的。

---

### 4️⃣ 计算最短路径树（SPF）

* 使用 Dijkstra 算法计算从自己到所有目的地的最短路径。
* 生成最终的路由表（Routing Table）。

---

### 5️⃣ 路由维护与更新

* 拓扑发生变化时（如链路断开），会重新计算 SPF。
* 更新仅限于变更部分，避免全网广播。

---

## 📐 OSPF 区域设计（Area）

为了控制路由器的负载和提升效率，OSPF 支持将网络划分为多个区域：

* **Backbone Area（区域 0）**：核心区域，所有其他区域必须与它直接或间接连接。
* **普通区域（Area 1、2…）**：连接在骨干区域上的普通区域。
* **Stub/NSSA 区域**：对外部路由限制传播的特殊区域，减少资源消耗。

---

## 🧮 OSPF Cost 计算方式（Cisco 默认）

```bash
Cost = 100,000,000 / 带宽（bps）
```

例如：

* FastEthernet (100 Mbps)：Cost = 1
* GigabitEthernet (1 Gbps)：Cost = 1（需手动调整）

---

## 🔐 OSPF 报文类型（重要的几种）

| 类型编号 | 报文类型                               | 作用           |
| ---- | ---------------------------------- | ------------ |
| 1    | Hello                              | 邻居发现和保持      |
| 2    | Database Description (DBD)         | 简略描述 LSDB 内容 |
| 3    | Link State Request (LSR)           | 请求特定 LSA     |
| 4    | Link State Update (LSU)            | 发送 LSA 更新    |
| 5    | Link State Acknowledgement (LSAck) | 确认收到的 LSA    |

---

## 🌍 示例网络拓扑与OSPF流程

```
[Router A]───[Router B]───[Router C]
     |                       |
  Area 0                 Area 1
```

* 所有路由器运行 OSPF
* A 和 B 属于 Area 0，B 和 C 属于 Area 1
* B 是 ABR（Area Border Router）连接两个区域
* C 想访问 A，会通过 B 转发，并根据 ABR 提供的汇总路由信息选择路径

---

## ✅ 总结优缺点

| 优点                    | 缺点                |
| --------------------- | ----------------- |
| 快速收敛、支持分区域设计          | 配置复杂，初学者学习曲线陡峭    |
| 资源消耗相对合理              | 不适合非常小的网络环境       |
| 支持 VLSM、CIDR、认证、安全等特性 | 需要理解 SPF 和 LSA 机制 |

---