TCP（Transmission Control Protocol，传输控制协议）的**流量控制（Flow Control）**是一种**端到端机制**，目的是防止**发送方发送数据过快**，以致于**接收方来不及处理**，从而导致数据丢失。流量控制的核心是基于**接收方的处理能力进行速率调节**。

---

### 🔧 流量控制的关键机制：**滑动窗口协议**

TCP使用的是**滑动窗口（Sliding Window）协议**来实现流量控制。

#### 🧠 核心思想：

* 每个TCP连接的接收方会告知发送方它当前还能接收多少字节的数据（称为**接收窗口大小（rwnd，receive window）**）。
* 发送方根据这个接收窗口大小决定可以发送多少数据。

---

### 📦 示例说明

假设：

* 接收方的缓存区总大小是 **1000 字节**；
* 当前已经接收了 700 字节还没处理；
* 那么剩余可用空间是 300 字节；
* 接收方会在 TCP ACK 报文中告诉发送方：**rwnd = 300**；
* 发送方就不会再发超过 300 字节的数据，直到收到接收方新的窗口更新。

---

### 🧮 滑动窗口的三个变量：

| 名称             | 描述                                         |
| -------------- | ------------------------------------------ |
| **发送窗口（swnd）** | 发送方允许发送的数据范围，由接收方提供的 rwnd 控制               |
| **接收窗口（rwnd）** | 接收方的缓冲区大小，通知给发送方                           |
| **拥塞窗口（cwnd）** | 与流量控制无关，是 TCP 拥塞控制的一部分（但与发送窗口联合决定实际能发多少数据） |

---

### 🛑 如果接收方 rwnd = 0？

* 表示接收方暂时处理不过来了，告诉发送方“暂停发送”。
* 此时发送方会进入\*\*持续计时器（Persist Timer）\*\*状态，定期发送一个 1 字节的探测包，确认接收窗口是否恢复。

---

### ✅ 总结一张图理解（概念层）：

```
       +-------------+                      +-------------+
       |   发送方    |=====================>|   接收方    |
       |（发送数据） |<=======窗口大小=======|（rwnd 告知）|
       +-------------+                      +-------------+
```

