## ğŸ” æ€»ä½“ç»“è®ºï¼ˆç»“è®ºå…ˆè¡Œï¼‰ï¼š

| æ™ºèƒ½æŒ‡é’ˆç±»å‹            | æŒ‡é’ˆæœ¬èº«çº¿ç¨‹å®‰å…¨   | æŒ‡å‘å¯¹è±¡çº¿ç¨‹å®‰å…¨ | å¤šçº¿ç¨‹ä½¿ç”¨éœ€æ³¨æ„          |
| ----------------- | ---------- | -------- | ----------------- |
| `std::unique_ptr` | âŒ ä¸å®‰å…¨      | å–å†³äºå¯¹è±¡    | **ä¸èƒ½è·¨çº¿ç¨‹å…±äº«**       |
| `std::shared_ptr` | âœ… å¼•ç”¨è®¡æ•°çº¿ç¨‹å®‰å…¨ | å–å†³äºå¯¹è±¡    | å…±äº«æ•°æ®æ—¶ï¼Œ**å¯¹è±¡æœ¬èº«éœ€åŠ é”** |

---

## ğŸ§  ä¸€ã€`std::shared_ptr` çš„çº¿ç¨‹å®‰å…¨ç»†èŠ‚ï¼š

### âœ… 1. **å¼•ç”¨è®¡æ•°æ˜¯çº¿ç¨‹å®‰å…¨çš„**

* å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ª `shared_ptr`ï¼Œåªè¦ä½ ä¸åŒæ—¶å†™è¿™ä¸ªæŒ‡é’ˆï¼ˆå³ä¸ä¿®æ”¹å®ƒï¼‰ï¼Œå®ƒçš„å†…éƒ¨å¼•ç”¨è®¡æ•°æ˜¯å®‰å…¨çš„ã€‚
* ä¾‹å¦‚ï¼š

  ```cpp
  std::shared_ptr<int> p = std::make_shared<int>(42);

  std::thread t1([p] { use(p); });
  std::thread t2([p] { use(p); });
  ```

  è¿™æ ·ä¼ å€¼ï¼ˆæ‹·è´æ„é€ ï¼‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

### âš ï¸ 2. **æŒ‡é’ˆæœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„**

* æ¯”å¦‚ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å†™ï¼ˆä¿®æ”¹ï¼‰`shared_ptr`ï¼š

  ```cpp
  std::shared_ptr<int> p;
  std::thread t1([&] { p = std::make_shared<int>(1); });
  std::thread t2([&] { p = std::make_shared<int>(2); });
  ```

  â›” **ä¸å®‰å…¨**ï¼éœ€è¦åŠ é”ä¿æŠ¤ `p`ã€‚

### âš ï¸ 3. **æŒ‡å‘å¯¹è±¡ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„**

* å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®/ä¿®æ”¹æŒ‡å‘çš„èµ„æºï¼Œä»ç„¶éœ€è¦è‡ªå·±åŠ é”ä¿æŠ¤ã€‚

---

## ğŸ§  äºŒã€`std::unique_ptr` çš„çº¿ç¨‹å®‰å…¨ç»†èŠ‚ï¼š

### âŒ **ä¸æ”¯æŒè·¨çº¿ç¨‹å…±äº«**

* `unique_ptr` æ˜¯ç‹¬å çš„ï¼Œä¸å…è®¸å¤åˆ¶ï¼Œåªèƒ½è½¬ç§»æ‰€æœ‰æƒã€‚
* å¦‚æœä½ çœŸçš„è¦å°†å®ƒä»ä¸€ä¸ªçº¿ç¨‹ä¼ ç»™å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œåªèƒ½ç”¨ `std::move`ï¼Œè€Œä¸”å¿…é¡»åšå¥½åŒæ­¥ã€‚

### ç¤ºä¾‹ï¼š

```cpp
std::unique_ptr<Data> p = std::make_unique<Data>();
std::thread t([ptr = std::move(p)]() mutable {
    // ptr now belongs to this thread
});
```

è¿™ä¸ªæ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºåªä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰å®ƒã€‚

---

## âœ… å®ç”¨å»ºè®®ï¼ˆä»€ä¹ˆæ—¶å€™åŠ é”ï¼‰

| æ“ä½œ                   | æ˜¯å¦éœ€è¦åŠ é”      |
| -------------------- | ----------- |
| å¤šçº¿ç¨‹åªè¯»åŒä¸€ä¸ª shared\_ptr | å¦           |
| å¤šçº¿ç¨‹è¯»å–å¯¹è±¡ï¼ˆå…±äº«èµ„æºï¼‰        | âœ… éœ€è¦ç»™å¯¹è±¡åŠ é”   |
| å¤šçº¿ç¨‹ä¿®æ”¹ shared\_ptr æœ¬èº« | âœ… éœ€è¦åŠ é”      |
| ä¼ é€’ unique\_ptr è·¨çº¿ç¨‹   | âœ… move æ—¶éœ€åŒæ­¥ |

---

## ğŸ› ï¸ ä¸¾ä¸ªå®Œæ•´ä¾‹å­

```cpp
std::shared_ptr<int> counter = std::make_shared<int>(0);
std::mutex m;

void thread_func(std::shared_ptr<int> c) {
    for (int i = 0; i < 10000; ++i) {
        std::lock_guard<std::mutex> lock(m);
        ++(*c);
    }
}

int main() {
    std::thread t1(thread_func, counter);
    std::thread t2(thread_func, counter);
    t1.join();
    t2.join();
    std::cout << *counter << std::endl;
}
```

âœ”ï¸ ä¸Šé¢çš„ä¾‹å­ï¼š

* `shared_ptr` å®‰å…¨ä¼ å…¥çº¿ç¨‹ï¼ˆè®¡æ•°çº¿ç¨‹å®‰å…¨ï¼‰ï¼›
* ä¿®æ”¹å…¶æŒ‡å‘çš„å¯¹è±¡æ—¶ï¼Œä½¿ç”¨ `mutex` ä¿æŠ¤ã€‚

---

## âœ… æ€»ç»“

| æ™ºèƒ½æŒ‡é’ˆ         | å¼•ç”¨è®¡æ•°çº¿ç¨‹å®‰å…¨ | æŒ‡å‘å†…å®¹çº¿ç¨‹å®‰å…¨ | é€‚ç”¨åœºæ™¯          |
| ------------ | -------- | -------- | ------------- |
| `shared_ptr` | æ˜¯        | å¦        | å¤šçº¿ç¨‹å…±äº«ã€åªè¯»/åŠ é”ä½¿ç”¨ |
| `unique_ptr` | æ—         | å¦        | ç‹¬å æ‰€æœ‰æƒï¼Œä¸å¯å…±äº«    |

---
