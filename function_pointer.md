函数指针是 C/C++ 中一种**可以指向函数的指针变量**。它的本质是：**存储一个函数地址的变量**，允许你在运行时“调用不同的函数”或“把函数作为参数传递”。

---

## 🧠 一句话理解函数指针：

> **函数指针就是指向函数的指针变量，可以像调用函数一样通过它来执行对应的函数。**

---

## ✅ 一、函数指针的定义和使用

### 1. 普通函数的定义：

```cpp
int add(int a, int b) {
    return a + b;
}
```

### 2. 定义函数指针：

```cpp
// 定义一个指向 "返回 int，参数为 int, int 的函数" 的指针
int (*fp)(int, int);
```

### 3. 让函数指针指向函数：

```cpp
fp = add;
```

或者更清晰一点：

```cpp
int (*fp)(int, int) = &add;  // 加 & 没问题，也可以省略
```

### 4. 使用函数指针调用函数：

```cpp
int result = fp(3, 5);  // 就像调用普通函数一样
```

---

## ✅ 二、函数指针的使用场景

### 1. **回调函数（callback）**

在需要在某个函数中**调用用户自定义的行为**时（例如排序时传入比较函数），函数指针是实现方式之一。

```cpp
void do_operation(int a, int b, int (*op)(int, int)) {
    std::cout << "结果是: " << op(a, b) << std::endl;
}
```

调用：

```cpp
do_operation(3, 4, add);
```

---

### 2. **策略模式 / 动态选择函数**

你可以在运行时决定调用哪个函数，比如：

```cpp
int add(int a, int b) { return a + b; }
int sub(int a, int b) { return a - b; }

int (*select_op(char op))(int, int) {
    if (op == '+') return add;
    else return sub;
}
```

---

### 3. **函数数组（实现菜单、命令表等）**

```cpp
void op1() { std::cout << "操作1\n"; }
void op2() { std::cout << "操作2\n"; }

void (*ops[])() = { op1, op2 };

ops[0]();  // 调用 op1
ops[1]();  // 调用 op2
```

---

### 4. **嵌入式开发 / 中断处理**

函数指针广泛用于：

* 注册中断服务函数（ISR）
* 配置硬件行为（回调）
* 状态机函数表

---

### 5. **类的成员函数指针（高级）**

成员函数的指针和普通函数指针不同：

```cpp
class MyClass {
public:
    void hello() { std::cout << "Hello\n"; }
};

void (MyClass::*fptr)() = &MyClass::hello;

MyClass obj;
(obj.*fptr)();  // 调用成员函数
```

---

## ✅ 三、函数指针的完整语法格式

```cpp
// 返回类型 (*指针名)(参数列表);
int (*fp)(int, int);
```

更复杂例子（指向函数的数组）：

```cpp
int (*ops[3])(int, int);  // 函数指针数组
```

---

## ✅ 四、函数指针 vs C++ 更现代的做法

| 方法              | 推荐程度  | 说明                   |
| --------------- | ----- | -------------------- |
| 函数指针            | ✅ 中等  | C风格，适合嵌入式/底层逻辑       |
| `std::function` | ✅✅✅ 高 | 更灵活，支持 lambda、仿函数、闭包 |
| Lambda 表达式      | ✅✅✅ 高 | 现代 C++ 推荐            |
| 模板+策略模式         | ✅✅✅ 高 | 编译时选择函数，性能更优         |

---

## ✅ 总结

| 项目        | 函数指针                              |
| --------- | --------------------------------- |
| 定义        | `int (*fp)(int, int);`            |
| 使用        | `fp = add;` → `fp(2, 3);`         |
| 主要用途      | 回调函数、动态选择函数、状态机、硬件回调              |
| 替代方案（C++） | `std::function`、Lambda 表达式、更安全更强大 |

---
