## 🧱 什么是 **内部碎片（Internal Fragmentation）**？

### 🔹 定义：

> 当操作系统分配的内存块比实际需要的要大，**多出来未使用的部分就叫内部碎片**。

### ✅ 特点：

* 出现在**固定大小的内存分配**中（如分页系统、分配整页或整块内存）
* 碎片**在已分配内存块内部**
* 用户看不到这些碎片，但它**浪费了内存**

### 📦 举个例子：

* 系统每次分配内存单位为 4KB
* 一个程序请求 6KB

  * 实际会分配 **2个页（8KB）**
  * 用了 6KB，**剩下的 2KB 没用上 → 内部碎片**

---

## 🧩 什么是 **外部碎片（External Fragmentation）**？

### 🔹 定义：

> 当内存中**空闲空间总量足够**，但由于**不连续**而无法满足一个大的内存请求，这些零散空间就称为外部碎片。

### ✅ 特点：

* 出现在**可变大小分配**或**连续分配**策略中（如段式管理、首次适应算法）
* 空闲内存分布在不同位置，不能被合并使用
* **碎片在已释放的空闲空间之间**

### 📦 举个例子：

* 假设内存空闲区域如下：

  * 4KB（空） + 2KB（被占用） + 6KB（空） + 1KB（被占用） + 5KB（空）
  * 你申请一个 10KB 的内存块
  * 空闲总量 = 4+6+5 = 15KB ✅
  * 但都是零碎分散的 ❌ → 无法满足连续 10KB → **外部碎片**

---

## 🆚 内部碎片 vs 外部碎片

| 对比项    | 内部碎片                | 外部碎片                |
| ------ | ------------------- | ------------------- |
| 发生位置   | 已分配块的**内部**         | 空闲块的**之间**          |
| 原因     | 分配的块比实际需求大          | 零散小空闲块无法合并成大块       |
| 是否连续内存 | 不依赖连续               | 需要连续内存              |
| 管理方式   | 分页（fixed-size）系统中常见 | 段式或连续分配中常见          |
| 解决方案   | 更小分配单元或动态分配算法       | 内存压缩（compaction）或分页 |

---

## ✅ 总结记忆口诀：

* **内部碎片**：块太大 → 内部空着
* **外部碎片**：空间够 → 连不起来

---