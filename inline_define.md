## 🧠 一句话区别总结

> `inline` 是**类型安全的函数机制**，现代 C++ 中还用于支持**多文件定义一致性**；
> `#define` 是**文本替换的宏机制**，不具备类型、安全、调试等能力，容易出错。

---

## ✅ 1. 定义方式与机制

| 方面   | `inline` 函数                | `#define` 宏函数        |
| ---- | -------------------------- | -------------------- |
| 本质   | 函数（由编译器处理）                 | 文本替换（由预处理器处理）        |
| 编译阶段 | 编译阶段生效                     | 预处理阶段生效              |
| 类型检查 | ✅ 有类型检查，语法规则完整             | ❌ 无类型检查，只是简单的字符替换    |
| 多次定义 | ✅ 支持在多个 `.cpp` 文件中定义（关键用途） | ✅ 可以多次定义（但容易污染全局作用域） |

---

## ✅ 2. 行为差异

| 方面    | `inline` 函数       | `#define` 宏函数     |
| ----- | ----------------- | ----------------- |
| 参数求值  | 只求值一次，安全          | 多次替换，可能多次求值导致副作用  |
| 作用域   | 有作用域，受命名空间、类限制    | 无作用域，全局污染命名空间     |
| 支持语法  | 支持复杂控制结构、重载、默认参数等 | 不支持复杂结构，只能表达简单表达式 |
| 错误定位  | 编译器能准确报错，易于调试     | 错误难定位，调试困难        |
| 函数栈信息 | 有（方便调试）           | 无（看不到宏展开栈信息）      |

---

## ✅ 3. 示例对比

### 🧨 错误宏函数示例（副作用）：

```cpp
#define SQUARE(x) ((x)*(x))
int result = SQUARE(i++);  // 等价于 ((i++) * (i++))，i 增加了两次！⚠️
```

### ✅ 正确的内联函数：

```cpp
inline int square(int x) {
    return x * x;
}
int result = square(i++);  // 只调用一次 i++，安全 ✔️
```

---

## ✅ 4. 现代 C++ 中 `inline` 的**新用途**

除了函数展开建议，现代 C++ 中 `inline` 还用于：

| 场景                  | 说明                                             |
| ------------------- | ---------------------------------------------- |
| 多文件头文件中定义函数         | `inline` 函数可以在多个 `.cpp` 中包含而不链接报错              |
| `constexpr` 或类内定义函数 | 自动具有 `inline` 属性                               |
| 内联变量（C++17 起）       | `inline const int a = 10;` 允许变量在头文件中定义而不重复定义冲突 |

---

## ✅ 使用建议

| 需求              | 推荐使用方式                      | 原因说明           |
| --------------- | --------------------------- | -------------- |
| 简单函数，需类型安全与调试支持 | ✅ `inline` 函数               | 类型安全、支持调试、语法灵活 |
| 常量、标志位          | ✅ `constexpr` 或 `inline` 变量 | 更符合现代语义、更安全    |
| 条件编译            | ✅ `#define/#ifdef`          | 宏的合适用途，宏擅长的场景  |
| 简单表达式替换（慎用）     | ⚠️ `#define` 宏              | 尽量避免，容易出错，慎用   |

---

## ✅ 总结重点

| 分类   | `inline` 函数           | `#define` 宏函数      |
| ---- | --------------------- | ------------------ |
| 安全性  | ✅ 高（类型检查、作用域）         | ❌ 低（无类型检查、副作用多）    |
| 功能强度 | ✅ 支持复杂函数、调试           | ❌ 仅适合简单文本替换        |
| 使用场景 | ✅ 推荐用于头文件、性能优化、安全函数定义 | ⚠️ 仅用于条件编译或非常简单的替换 |

---