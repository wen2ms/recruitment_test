> **既然建立连接要三次握手，为什么断开连接不能对称地用“三次挥手”？为什么一定是四次？**

---

## 🎯 结论先说：

> **因为 TCP 是**全双工连接\*\*（双向都可以发送数据），关闭连接时双方需要**分别关闭自己的一端**，因此需要**四次挥手**。

---

## 🧠 TCP 连接的关闭流程

TCP 中的连接关闭是双方**分别发起**的，而不是一起说“断了就断了”这么简单。

它的流程如下：

| 步骤 | 谁发       | 内容  | 含义            |
| -- | -------- | --- | ------------- |
| ①  | 主动关闭方（A） | FIN | 我不发数据了        |
| ②  | 被动关闭方（B） | ACK | 我知道你不发了       |
| ③  | 被动关闭方（B） | FIN | 我也不发了         |
| ④  | 主动关闭方（A） | ACK | 我知道你也不发了，彻底关闭 |

---

### ❓为什么不能合并成 3 次？

表面上看，好像可以把第 ② 步和第 ③ 步合并成 `FIN + ACK` 一起发，但这在**实际应用中很难成立**：

### 原因一：**B 可能还有数据没发完**

* TCP 是全双工协议，A 不发了，不代表 B 就能马上不发。
* 所以 B **必须等数据发送完毕**，才能发送 FIN。

👉 **第 ② 步和第 ③ 步之间有时间差，不一定能合并！**

---

### 原因二：**ACK 和 FIN 含义不同**

* `ACK` 是确认之前对方的 `FIN`。
* `FIN` 是自己发出“我要断开”的信号。
* **逻辑上不能省略其中任意一步**，否则可能引发协议状态混乱。

---

### 举个例子：

```text
Client            Server
   |    FIN ——>       |   ← A 发起关闭
   | <——  ACK         |   ← B 确认收到
   |                  |   ← B 继续发数据...
   | <——  FIN         |   ← B 发完了，也要关闭
   |    ACK ——>       |   ← A 确认收到，连接彻底断开
```

如果你强行变成三次，比如：

```text
Client            Server
   |    FIN ——>       |
   | <—— FIN+ACK      | ← 一次合并
   |    ACK ——>       |
```

这只在 **双方都无数据再发，且完全同步** 的情况下才能成立，**不具备通用性**，违背了 TCP 的可靠设计原则。

---

## ✅ 总结一句话：

> **断开连接时，双方都要分别说“我不发了”，并得到确认；由于关闭动作可能不同时发生，所以需要四次挥手。**

TCP 是全双工、可靠传输协议，它的每一个状态变更都必须明确、确认，这也是 TCP 稳定和可靠的根本原因。
